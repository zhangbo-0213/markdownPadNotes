# 开发工具使用笔记  
## Cmake   
### 简介   
Cmake 是源代码编译管理工具，能够跨平台构建指定目标的工程项目文件，通过配置CmakeList.txt文件，实现一次配置(通过配置去完成 预处理，编译，汇编，链接过程的指令)生成跨平台的可执行文件      

---    
### compile make build 区别     
- compile:只编译选定目标，不管之前是否编译过  
- make:只编译上次改变过的文件，提高编译效率   
- build:是对整个工程进行彻底的重新编译，而不管是否已经编译过。Build过程往往会生成发布包，这个具体要看对IDE的配置
了，Build在实际中应用很少，因为开发时候基本上不用，发布生产时候一般都用ANT等工具来发布。Build因为要全部编译，还要执行打包等额外工
作，因此时间较长。    

### Cmake使用及配置     
[Cmake配置](https://www.jianshu.com/p/c042abb42133) 
### 单目录单源文件配置示例  
./ main.cpp    
配置：   
```  
CAMKE_MINIMUM_REQUIRED(VERSION 3.12)    //指定CMAKE的版本     
PROJECT(demo1  CXX JAVA)     //生成的工程的工程名 指定语言，可不指定   
ADD_EXECUTABLE(demo1 main.cpp)   //生成的可执行文件名和源文件       
```   
当前目录下执行 cmake ./  命令生成对应 makefile文件     
执行 make 命令(依赖makefile文件)build工程，并生成可执行文件 demo1     
执行 ./demo1 传入参数    运行可执行文件   

### 单目录多源文件配置示例    
./main.cpp mymath.cpp mymath.h   
mymath.cpp include mymath.h  
main.cpp 调用 mymath.cpp    

```  
CMAKE_MINIMUM_REQUIRED(VERSION 3.12)     
PROJECT(demo2)  
ADD_EXECUTABLE(demo2 main.cpp mymath.cpp)  
```    
针对目录下源文件较多的情况，引入命令：   
``` 
AUX_SOURCE_DIRECTORY(dir VAR)   
//该命令将 dir 目录下的所有源文件名 储存在变量 VAR中    
```   
ADD_EXECUTABLE()  调用该变量    
``` 
ADD_EXECUTABLE(./ ${VAR})
```   
上述 CmakeList.txt 可写成：   
```
CMAKE_MINIMUM_REQUIRED(VERSION 3.12)   
PROJECT(demo2)    
AUX_SOURCE_DIRECTORY(./ DIR_SRCS)
ADD_EXECUTABLE(demo2 ${DIR_SRCS})  
```  

### 多目录多源文件配置示例  
文件目录：  
./ CmakeList.txt | main.cpp | mylib(./CmakeList.txt | mymath.cpp | mymath.h)    
上层目录中的 main.cpp 需要引用 下层目录中的 mymath.cpp 方法   

子目录的源文件 打包成 库文件 供上层目录调用,子目录的CmakeList.txt 配置：  
```c
AUX_SOURCE_DIRECTORY(./ DIR_SRCS)   
ADD_LIBRARY(Mylib STATIC|SHARED ${DIR_SRCS}) //将该目录下的源文件生成名为 Mylib 库文件,通过中间的可选参数设定库位静态库还是动态库  
```  
上层目录下的 CmakeList.txt 需要引入子目录文件，并链接子目录生成的库：  
``` c
ADD_SUBDIRECTORY(./mylib)   
TARGET_LINK_LIBRARIES(target libFileName) //target 为生成的可执行文件名  
```  
上层CmakeList.txt完整配置：  
``` c
CMAKE_MINIMUM_REQUIRED(VERSION 3.12) 
PROJECT(demo3)  
ADD_SUBDIRECTORY(./mylib)
AUX_SOURCE_DIRECTORY(./ DIR_SRCS)  
ADD_EXECUTABLE(demo3 ${DIR_SRCS}) 
TARGET_LINK_LIBRARIES(demo3 Mylib) //这里的Mylib由子目录中的CmakeList.txt配置链接库生成  
```

### 多目录多源文件 标准工程目录 配置示例  
标准工程文件目录结构：   
./src | mylib | build | CmakeList.txt    
- src/demo4.cpp ｜ CmakeList.txt  --src目录下的CmakeList.txt配置：  
``` c 
INCLUDE_DIRECTORICES(${PROJECT_SOURCE_DIR}/mylib) //添加依赖的头文件  ${PROJECT_SOURCE_DIR} 该变量表示当前工程的跟目录
AUX_SOURCE_DIRECOTRY(./ DIR_SRCS)  
ADD_EXECUTABLE(demo4 ${DIR_SRCS}) 
TARGET_LINK_LIBRARIES(demo4 Mylib)
```   
- mylib/mymath.cpp | mymath.h | CmakeList.txt --mylib下的CmakeList.txt配置：    
```c
AUX_SOURCE_DIRECTORY(./ DIR_SRCS) 
ADD_LIBRARY(Mylib STATIC ${DIR_SRCS})   
//该目录下的源文件生成名为 Mylib 库文件 
```    
- 最外层的 CmakeList.txt 配置：   
``` c
CMAKE_MINIMUM_REQUIRED(3.12)
PROJECT(demo4)  
ADD_SUBDIRECTORY(./mylib)
ADD_SUBDIRECTORY(./src)   
//最外层的CmakeList.txt 只包含最基本的版本要求，工程名，及需要使用的子目录，生成可执行文件的Cmake配置指令在src目录中已经配置  
```  
进入bulid目录执行  cmake ..  命令（这里的cmake命令目录为顶层的CmakeList.txt目录），然后执行 make 命令        

为了使 mylib 文件夹中配置后生成的 库文件 存放在单独的 lib 文件夹中，对mylib目录下的CmakeList.txt进行配置修改 ：   
``` c
AUX_SOURCE_DIRECTORY(./ DIR_SCRS) 
SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)  
//这句指令是指设置库文件输出目录 ${PROJECT_BINARY_DIR} 是指执行 cmake命令所在的目录，在本示例中执行的目录是 build 文件夹下，所以在执行完 cmake后，build文件夹下会有一个 lib 文件夹存放生成的 库文件
ADD_LIBRARY(Mylib STATIC ${DIR_SCRS})  
```   
同理，为了使src目录下的指令生成的可执行文件在单独的 bin 文件夹中，对 src目录下的 CmakeList.txt 修改配置：    
``` c
INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/mylib)  
AUX_SOURCE_DIRECTORY(./ DIR_SRCS) 
SET(EXECUTEABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)   
//该指令设置了生成的 可执行文件 所在目录，在执行cmake命令所在的目录(build)下的bin文件夹中     
ADD_EXECUTABLE(demo4 ${DIR_SRCS})  
TARGET_LINK_LIBRARIES(demo4 Mylib)
```     

### 自定义编译选项  
通过一个config文件内的配置选项与CmakeList.txt内的指令配合，来控制源文件在编译过程中是否启用宏定义，其中CmakeList.txt 读取 config 文件内的选项并根据选项设定的值进行编译，汇编和链接 
- config.hpp.in文件内容示例：  
``` c 
#cmakedefine USE_MYMATH   
//使用cmakedefine指令 定义 USE_MYMATH 选项   
```   
- src文件夹内CmakeList.txt 配置示例：    
``` c
AUX_SOURCE_DIRECTORY(./ SRCS_DIR) 
SET(EXECUTEABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}bin)     

CONFIGURE_FILE(
    "${PROJECT_SOURCE_DIR}/config/config.hpp.in"     
    //指定输入文件
    "${PROJECT_SOURCE_DIR}/config/config.hpp"  
    //指定配置后的输出文件
)

//OPTION指令 指定要设置的 选项名 默认状态
OPTION(
    USE_MYMATH 
    ON 
)

//当USE_MYMATH选项设定为 ON 时，加入该include路径
IF(USE_MYMATH)
INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/mylib) 
ENDIF(USE_MYMATH)

ADD_EXECUTEABLE(demo5 ${SRCS_DIR})  
TARGET_LINK_LIBRARIES(demo5 Mylib)
``` 
