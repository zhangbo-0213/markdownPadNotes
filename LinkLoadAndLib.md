## 链接、装载与库 ##
系统软件体系结构：      
![](https://i.imgur.com/a51Cn1R.png)         

源代码到可执行文件经历过程：      
**预处理（Prepressing）**     
**编译（Conpilation）**     
**汇编（Assembly)**    
**链接（Linking）**          
![](https://i.imgur.com/tbX2vMn.png)                

编译过程    
编译过程一般可分为6步：     
扫描，语法分析，语义分析，源代码优化，代码生成和目标代码优化        
![](https://i.imgur.com/SHDoVQU.png)            

最基本的静态链接过程：        
![](https://i.imgur.com/HlqCCZ9.png)                      

静态链接的具体过程：          
对于链接器，整个链接过程中是将几个输入的目标文件进行加工合并后输出一个可执行文件。加工过程主要包括 **空间与地址分配&符号解析与重定位** （连接过程中计算得到的地址为虚拟地址）           
对于多个目标文件的合并过程，主要采用相似段合并策略：      
![](https://i.imgur.com/2Wk57PC.png)            
**空间与地址分配**       
链接器扫描所有输入的目标文件，得到各个段的长度，属性及位置，将输入目标文件中的符号表所有的符号定义和符号引用收集起来，统一放到一个全局符号表。链接器将所有输入的目标文件合并，计算输出文件中各个段合并后的长度与位置，建立映射关系。        
**符号解析与重定位**     
链接器利用上一步收集到的信息，读取输入文件中段的数据、重定位信息，进行符号解析和重定位、调整代码中的地址。      

**为什么需要进行符号解析与重定位？**       
在编写源代码时，各个模块之间需要进行相互引用，各个模块在编译后得到对应的目标文件。而在编译时，全局变量和函数（即符号）的位置分为两种情况：       
1.符号定义在模块内        
定义在模块内的符号在编译时会存储在目标文件的符号表（段）中，记录相对于段首的偏移，**在进行链接时**，多个目标文件的相似段需要进行合并，因此需要根据合并后的情况调整定义在各个模块内的符号地址。         
2.符号定义在模块外        
这种情况下，符号定义在其他模块中，该模块引用这些符号。这种情况下在进行编译时，编译器并不知道这些符号的准确地址，因此针对引用的符号，会有一个对应的重定位段，专门记录这些引用的符号，编译器会给这些符号一个临时地址，真正的地址交给链接器来处理，链接器会对每个需要重定位的符号进行地址修正。   
  
